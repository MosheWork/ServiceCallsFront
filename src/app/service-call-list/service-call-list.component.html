<div class="service-call-list" dir="rtl">
  <mat-card class="header-card">
    <h1>拽专转 砖专转</h1>
  </mat-card>

  <!--  Filter card -->
  <mat-card class="filter-card">
    <div class="filter-row">

      <!-- 驻砖 驻砖 -->
      <mat-form-field appearance="outline" class="filter-field">
        <mat-label>驻砖 驻砖</mat-label>
        <input
          matInput
          [(ngModel)]="searchText"
          (ngModelChange)="applyFilter()"
          placeholder="转专转, 转专, 砖转砖, 砖..."
        />
        <button
          *ngIf="searchText"
          matSuffix
          mat-icon-button
          aria-label="拽"
          (click)="searchText=''; applyFilter()">
          <mat-icon>close</mat-icon>
        </button>
      </mat-form-field>

      <div class="filter-buttons">
        <button mat-stroked-button color="primary" (click)="clearFilters()">
          驻住 驻专
        </button>
        <button mat-flat-button color="primary" (click)="loadData()">
          专注
        </button>
      </div>
    </div>
  </mat-card>

  <!-- 爪 注 / 砖 -->
  <div class="loading-container" *ngIf="isLoading">
    <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
    <div class="loading-text">注 转...</div>
  </div>

  <mat-card *ngIf="!isLoading && errorMessage" class="error-card">
    {{ errorMessage }}
  </mat-card>

  <!--  -->
  <mat-card *ngIf="!isLoading && !errorMessage">
    <div class="table-container">
      <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z2">

        <!-- # -->
        <ng-container matColumnDef="index">
          <th mat-header-cell *matHeaderCellDef>#</th>
          <td mat-cell *matCellDef="let row; let i = index">
            {{ i + 1 }}
          </td>
        </ng-container>

        <!-- 转专 驻转 -->
        <ng-container matColumnDef="entryTime">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>转专 驻转</th>
          <td mat-cell *matCellDef="let row">
            {{ formatDate(row.entryTime) }}
          </td>
        </ng-container>

        <!-- 转专转 -->
        <ng-container matColumnDef="title">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>转专转</th>
          <td mat-cell *matCellDef="let row">
            {{ row.title }}
          </td>
        </ng-container>

        <!-- 砖转砖 驻转 -->
        <ng-container matColumnDef="requestUser">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>砖转砖 驻转</th>
          <td mat-cell *matCellDef="let row">
            {{ row.requestUser }}
          </td>
        </ng-container>

        <!-- 驻 -->
        <ng-container matColumnDef="callbackPhone">
          <th mat-header-cell *matHeaderCellDef>驻</th>
          <td mat-cell *matCellDef="let row">
            {{ row.callbackPhone }}
          </td>
        </ng-container>

<!-- 拽专 专砖转 + 驻专 -->
<ng-container matColumnDef="mainCategoryName">
  <th mat-header-cell *matHeaderCellDef>

    <!-- 转专转 + 拽 转 砖专 -->
    <div class="header-filter-wrapper"
         [matMenuTriggerFor]="mainCategoryMenu"
         (click)="$event.stopPropagation()">

      <span class="header-title">拽专</span>

      <!-- 拽 爪注 转 注爪 砖砖 专 -->
      <mat-icon
        class="header-filter-icon"
        [ngClass]="{ 'active-filter': selectedMainCategories.length > 0 }">
        filter_list
      </mat-icon>

    </div>

    <!-- 转驻专 -->
    <mat-menu
      #mainCategoryMenu="matMenu"
      xPosition="before"
      [overlapTrigger]="false">

      <div class="filter-menu">
        <div class="filter-options">
          <mat-checkbox
            *ngFor="let m of distinctMainCategories"
            [checked]="selectedMainCategories.includes(m)"
            (change)="onMainCategoryCheckboxChange($event.checked, m)">
            {{ m }}
          </mat-checkbox>
        </div>
      </div>

      <mat-divider></mat-divider>

      <button mat-menu-item (click)="clearMainCategoryFilter()">
        驻住 住
      </button>
    </mat-menu>

  </th>

  <td mat-cell *matCellDef="let row">
    {{ row.mainCategoryName }}
  </td>
</ng-container>





        <!-- 转转志拽专 1 -->
        <ng-container matColumnDef="subCategory1Name">
          <th mat-header-cell *matHeaderCellDef>转转志拽专 1</th>
          <td mat-cell *matCellDef="let row">
            {{ row.subCategory1Name }}
          </td>
        </ng-container>

        <!-- 转转志拽专 2 -->
        <ng-container matColumnDef="subCategory2Name">
          <th mat-header-cell *matHeaderCellDef>转转志拽专 2</th>
          <td mat-cell *matCellDef="let row">
            {{ row.subCategory2Name }}
          </td>
        </ng-container>

<!-- 住住 + 驻专 -->
<ng-container matColumnDef="statusName">
  <th mat-header-cell *matHeaderCellDef>

    <div class="header-filter-wrapper"
         [matMenuTriggerFor]="statusMenu"
         (click)="$event.stopPropagation()">

      <span class="header-title">住住</span>
      <mat-icon class="header-filter-icon">filter_list</mat-icon>

    </div>

    <mat-menu #statusMenu="matMenu" xPosition="before">
      <div class="filter-menu">
        <div class="filter-options">
          <mat-checkbox
            *ngFor="let s of distinctStatuses"
            [checked]="selectedStatuses.includes(s)"
            (change)="onStatusCheckboxChange($event.checked, s)">
            {{ s }}
          </mat-checkbox>
        </div>
      </div>

      <mat-divider></mat-divider>

      <button mat-menu-item (click)="clearStatusFilter()">
        驻住 住
      </button>
    </mat-menu>

  </th>

  <td mat-cell *matCellDef="let row">
    {{ row.statusName }}
  </td>
</ng-container>



        <!-- 注驻转 -->
        <ng-container matColumnDef="priorityName">
          <th mat-header-cell *matHeaderCellDef>注驻转</th>
          <td mat-cell *matCellDef="let row">
            {{ row.priorityName }}
          </td>
        </ng-container>

        <!-- 爪转 驻 -->
        <ng-container matColumnDef="teamInChargeName">
          <th mat-header-cell *matHeaderCellDef>爪转 驻</th>
          <td mat-cell *matCellDef="let row">
            {{ row.teamInChargeName }}
          </td>
        </ng-container>

        <!-- 砖转砖 驻 -->
        <ng-container matColumnDef="userInChargeName">
          <th mat-header-cell *matHeaderCellDef>砖转砖 驻</th>
          <td mat-cell *matCellDef="let row">
            {{ row.userInChargeName }}
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>

        <tr mat-row
            *matRowDef="let row; columns: displayedColumns"
            (click)="openDetails(row)"
            class="clickable-row">
        </tr>
      </table>
    </div>

    <mat-paginator
      [pageSize]="20"
      [pageSizeOptions]="[10, 20, 50, 100]"
      showFirstLastButtons>
    </mat-paginator>
  </mat-card>
</div>
